<!DOCTYPE html>
<html>
<head>
    <meta charset="UTF-8">
    <title>Nutri-Lite CRM (è¿›é˜¶ç‰ˆ)</title>
    <style>
        body { font-family: sans-serif; padding: 20px; background: #f4f7f6; }
        .container { max-width: 600px; margin: auto; background: white; padding: 20px; border-radius: 10px; box-shadow: 0 4px 6px rgba(0,0,0,0.1); }
        .input-group { display: flex; gap: 10px; margin-bottom: 20px; }
        input { flex: 1; padding: 10px; border: 1px solid #ddd; border-radius: 5px; }
        button { padding: 10px 15px; border: none; border-radius: 5px; cursor: pointer; color: white; }
        .btn-add { background: #28a745; }
        .btn-update { background: #ffc107; color: #333; }
        .product-card { border-bottom: 1px solid #eee; padding: 15px 0; display: flex; justify-content: space-between; align-items: center; }
        .actions { display: flex; gap: 5px; }
        .btn-del { background: #dc3545; font-size: 12px; }
        .btn-edit { background: #007bff; font-size: 12px; }
    </style>
</head>
<body>
    <div class="container">
        <h1>Nutri-Lite äº§å“ç®¡ç†</h1>
        
        <div class="input-group">
            <input type="text" id="pName" placeholder="å“å">
            <input type="number" id="pPrice" placeholder="ä»·æ ¼">
            <button id="mainBtn" class="btn-add" onclick="handleAction()">æäº¤åˆ°ä»“åº“</button>
        </div>

        <div id="displayArea">åŠ è½½ä¸­...</div>
    </div>

    <script>
        let currentEditId = null; // ğŸ’¡ è®°å½•å½“å‰æ­£åœ¨ä¿®æ”¹å“ªä¸ªäº§å“çš„ ID

        // 1. è·å–åˆ—è¡¨
        async function refreshList() {
            const res = await fetch('http://localhost:3000/products');
            const data = await res.json();
            document.getElementById('displayArea').innerHTML = data.map(item => `
                <div class="product-card">
                    <div><strong>${item.name}</strong> - $${item.price}</div>
                    <div class="actions">
                        <button class="btn-edit" onclick="startEdit(${item.id}, '${item.name}', ${item.price})">ç¼–è¾‘</button>
                        <button class="btn-del" onclick="deleteProduct(${item.id})">åˆ é™¤</button>
                    </div>
                </div>
            `).join('');
        }

        // 2. å‡†å¤‡ç¼–è¾‘ï¼šç‚¹å‡»â€œç¼–è¾‘â€æŒ‰é’®æ—¶ï¼ŒæŠŠæ•°æ®å¡«å›è¾“å…¥æ¡†
        function startEdit(id, name, price) {
            currentEditId = id;
            document.getElementById('pName').value = name;
            document.getElementById('pPrice').value = price;
            const btn = document.getElementById('mainBtn');
            btn.innerText = "ä¿å­˜ä¿®æ”¹";
            btn.className = "btn-update";
        }

        // 3. æ ¸å¿ƒé€»è¾‘ï¼šåˆ¤æ–­æ˜¯â€œæ–°å¢â€è¿˜æ˜¯â€œä¿®æ”¹â€
        async function handleAction() {
            const name = document.getElementById('pName').value;
            const price = document.getElementById('pPrice').value;
            if (!name || !price) return alert("è¯·å¡«å®Œæ•´");

            if (currentEditId) {
                // æ‰§è¡Œâ€œæ”¹â€çš„é€»è¾‘ (PUT)
                await fetch(`http://localhost:3000/products/${currentEditId}`, {
                    method: 'PUT',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ name, price })
                });
                currentEditId = null; // é‡ç½®
                document.getElementById('mainBtn').innerText = "æäº¤åˆ°ä»“åº“";
                document.getElementById('mainBtn').className = "btn-add";
            } else {
                // æ‰§è¡Œâ€œå¢â€çš„é€»è¾‘ (POST)
                await fetch('http://localhost:3000/products', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ name, price })
                });
            }

            document.getElementById('pName').value = "";
            document.getElementById('pPrice').value = "";
            refreshList();
        }

        // åˆ é™¤é€»è¾‘
        async function deleteProduct(id) {
            if (confirm("ç¡®å®šåˆ é™¤ï¼Ÿ")) {
                await fetch(`http://localhost:3000/products/${id}`, { method: 'DELETE' });
                refreshList();
            }
        }

        refreshList();
    </script>
</body>
</html>